<div
  class="modal-backdrop"
  (click)="onBackdropClick()"
  (keydown)="$event.stopPropagation()"
>
  <div
    #modalRoot
    class="modal"
    (click)="$event.stopPropagation()"
    (keydown)="onKeydown($event)"
    role="dialog"
    aria-modal="true"
  >
    <header class="modal-header">
      <h3>{{ "CHAT.ATTACHMENTS_TITLE" | translate }}</h3>
      <button
        type="button"
        class="btn btn-ghost btn-sm"
        (click)="closed.emit()"
        [attr.aria-label]="'COMPOSER.CANCEL' | translate"
      >
        <mat-icon fontIcon="close"></mat-icon>
      </button>
    </header>

    <section class="modal-body" *ngIf="!loading(); else loadingTpl">
      <div *ngIf="files().length === 0" class="empty">
        <div>{{ "CHAT.ATTACHMENTS_EMPTY" | translate }}</div>
      </div>
      <ul class="files-grid">
        <li *ngFor="let f of files()" class="file-item">
          <div
            class="thumb"
            [class.is-image]="isImage(f)"
            [class.is-pdf]="isPdf(f)"
          >
            <img *ngIf="isImage(f)" [src]="f.url" [alt]="f.filename" />
            <mat-icon *ngIf="!isImage(f)">{{
              isPdf(f) ? "picture_as_pdf" : "description"
            }}</mat-icon>
          </div>
          <div class="meta">
            <div class="name" [title]="f.filename">{{ f.filename }}</div>
            <div class="type">{{ f.content_type }}</div>
          </div>
          <div class="actions">
            <a class="btn" [href]="f.url" target="_blank" rel="noopener">
              <mat-icon class="text-sm mr-1">open_in_new</mat-icon>
              {{ "COMMON.OPEN" | translate }}
            </a>
            <a class="btn" [href]="f.url + '?download=true'">
              <mat-icon class="text-sm mr-1">download</mat-icon>
              {{ "FILES_PAGE.DOWNLOAD" | translate }}
            </a>
          </div>
        </li>
      </ul>
    </section>

    <ng-template #loadingTpl>
      <div class="loading">
        <div>{{ "COMMON.LOADING" | translate }}â€¦</div>
      </div>
    </ng-template>
  </div>
</div>
