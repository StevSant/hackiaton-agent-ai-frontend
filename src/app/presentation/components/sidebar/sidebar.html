<aside class="h-screen w-72 p-4 flex flex-col border-r sticky top-0 vt-sidebar">
  <div class="flex flex-col h-full gap-3">
    <div class="flex items-center justify-between gap-2">
      <div class="flex items-center justify-center w-full gap-3">
        <button
          [routerLink]="['/']"
          class="flex items-center gap-2 rounded-xl bg-gradient-to-l from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 transition-all duration-300 cursor-pointer py-2.5 px-4 text-white font-semibold shadow-lg hover:shadow-xl relative overflow-hidden"
        >
          <mat-icon class="text-lg">home</mat-icon>
          {{ "COMMON.HOME" | translate }}
        </button>
        <button
          class="flex items-center gap-2 text-sm rounded-lg px-3 py-2 bg-gradient-to-r from-gray-500/20 to-gray-600/20 hover:from-gray-400/30 hover:to-gray-500/30 backdrop-filter backdrop-blur-sm border border-white/10 hover:border-white/20 transition-all duration-300"
          (click)="tryLoad()"
          [disabled]="isLoading"
        >
          <mat-icon fontIcon="refresh" class="text-base"></mat-icon>
          {{ "COMMON.REFRESH" | translate }}
        </button>
      </div>
      <!-- Profile icon/menu moved to footer -->
    </div>

    <button
      class="flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 transition-all duration-300 cursor-pointer py-3 px-6 text-white font-semibold shadow-lg hover:shadow-xl relative overflow-hidden group"
      (click)="newChat()"
    >
      <mat-icon class="text-lg group-hover:scale-110 transition-transform duration-300">edit_square</mat-icon> 
      {{ "COMMON.NEW_CHAT" | translate }}
    </button>

    <div class="flex-1 overflow-y-auto" #scrollContainer>
      <div class="text-sm font-medium px-3 py-2 mb-3 rounded-lg bg-gradient-to-r from-gray-600/20 to-gray-700/20 backdrop-filter backdrop-blur-sm border border-white/10">
        {{ "COMMON.HISTORY" | translate }}
      </div>
      <ng-container>
        <div *ngIf="isLoading" class="px-2 py-2">
          <div class="space-y-2">
            <div
              class="h-8 rounded-md bg-[hsl(var(--card)_/_0.55)] animate-pulse"
            ></div>
            <div
              class="h-8 rounded-md bg-[hsl(var(--card)_/_0.55)] animate-pulse"
            ></div>
            <div
              class="h-8 rounded-md bg-[hsl(var(--card)_/_0.55)] animate-pulse"
            ></div>
            <div
              class="h-8 rounded-md bg-[hsl(var(--card)_/_0.55)] animate-pulse"
            ></div>
          </div>
        </div>
        <div
          *ngIf="!isLoading && sessions.length === 0"
          class="px-4 py-6 text-center"
        >
          <div class="rounded-xl bg-gradient-to-br from-gray-500/10 to-gray-600/10 backdrop-filter backdrop-blur-sm border border-white/5 p-4">
            <mat-icon class="text-3xl opacity-30 mb-2">history</mat-icon>
            <div class="text-sm opacity-60">{{ "COMMON.NO_SESSIONS" | translate }}</div>
          </div>
        </div>
        <ul class="space-y-2">
          <li
            *ngFor="let s of sessions; trackBy: trackBySessionId"
            class="group rounded-xl transition-all duration-300 hover:scale-[1.02]"
          >
            <div class="grid grid-cols-[1fr_auto] items-center px-3 py-3 gap-3">
              <button class="text-left flex-1 min-w-0 group-hover:translate-x-1 transition-transform duration-300" (click)="openSession(s)">
                <div class="min-w-0">
                  <div
                    class="text-sm font-medium max-w-40 whitespace-nowrap overflow-hidden text-ellipsis group-hover:text-blue-300 transition-colors duration-300"
                    [title]="
                      sanitizeTitle(s.title) ||
                      ('CHAT.SESSION' | translate) + ' ' + s.session_id.slice(0, 6)
                    "
                  >
                    {{
                      sanitizeTitle(s.title) || ("CHAT.SESSION" | translate) + " " + s.session_id.slice(0, 6)
                    }}
                  </div>
                  <div
                    *ngIf="sanitizeTitle(s.summary)"
                    class="text-xs opacity-70 max-w-40 whitespace-nowrap overflow-hidden text-ellipsis"
                    [title]="sanitizeTitle(s.summary || '')"
                  >
                    {{ sanitizeTitle(s.summary) }}
                  </div>
                </div>
              </button>
              <button
                class="btn btn-ghost btn-xs text-error transition-all duration-300 hover:scale-110"
                (click)="openDeleteModal(s, $event)"
                [title]="'COMMON.DELETE' | translate"
              >
                <mat-icon fontIcon="delete" class="text-sm"></mat-icon>
              </button>
            </div>
          </li>
        </ul>
        <div class="py-2 flex justify-center text-xs opacity-60" #sentinel>
          <ng-container *ngIf="isLoading">{{
            "COMMON.LOADING" | translate
          }}</ng-container>
          <ng-container *ngIf="!isLoading">&nbsp;</ng-container>
        </div>
      </ng-container>
    </div>

    <!-- Footer: reusable profile menu + admin entry button -->
    <div class="mt-4 pt-4 border-t relative" style="border-color: hsl(var(--border))">
      <button
        *ngIf="profileRole() === 'admin'"
        [routerLink]="['/admin']"
        class="w-full mb-3 py-2.5 px-4 flex items-center justify-center gap-2 rounded-xl bg-gradient-to-l from-purple-600 to-fuchsia-500 hover:from-purple-500 hover:to-fuchsia-400 transition-all duration-300 cursor-pointer text-white font-semibold shadow-lg hover:shadow-xl relative overflow-hidden group"
      >
        <mat-icon fontIcon="admin_panel_settings" class="text-lg group-hover:scale-110 transition-transform duration-300"></mat-icon>
        {{ "COMMON.ADMIN" | translate }}
      </button>
      <app-profile-menu
        [showBackToChat]="false"
        [showBackHome]="true"
        (closed)="closed.emit()"
      >
      </app-profile-menu>
    </div>
  </div>
</aside>
