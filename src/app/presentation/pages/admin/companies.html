<div class="p-6 space-y-4 vt-page">
  <h2 class="text-xl font-semibold sticky top-0 z-20 bg-card/70 backdrop-blur rounded-md p-2">{{ 'ADMIN.COMPANIES.TITLE' | translate }}</h2>
  <form [formGroup]="form" (ngSubmit)="applySearch()" class="glass-card p-3 flex flex-wrap gap-2 items-end">
    <input class="input input-bordered flex-1 min-w-[220px]" formControlName="search" [placeholder]="'ADMIN.COMPANIES.SEARCH_PLACEHOLDER' | translate" />
    <button class="btn btn-primary" type="submit">{{ 'ADMIN.COMPANIES.SEARCH_BUTTON' | translate }}</button>
    <div class="md:ml-auto flex items-center gap-2 w-full sm:w-auto">
      <label class="text-xs" for="companies-limit">{{ 'ADMIN.COMPANIES.LIMIT' | translate }}</label>
  <select id="companies-limit" class="select select-bordered select-sm w-full sm:w-auto" [value]="limit()" (change)="limit.set(+$any($event.target).value); applySearch()">
        <option [value]="10">10</option>
        <option [value]="20">20</option>
        <option [value]="50">50</option>
      </select>
    </div>
  </form>
  <div class="glass-card p-2 flex flex-wrap gap-2 items-center">
    <span class="text-xs opacity-70">{{ 'ADMIN.COMPANIES.SECTOR' | translate }}:</span>
    <button class="badge badge-outline badge-xs" [class.badge-primary]="!selectedSector()" (click)="selectSector('')">{{ 'COMMON.ALL' | translate }}</button>
    @for (s of sectors(); track s) {
      <button class="badge badge-outline badge-xs" [class.badge-primary]="selectedSector()===s" (click)="selectSector(s)">{{ s }}</button>
    }
  </div>
  @if (error()) {
    <div class="alert alert-error">{{ error() }}</div>
  }
  <div class="overflow-x-auto glass-card">
    <table class="table table-sm users-table">
  <thead>
        <tr>
          <th>
            <button class="btn btn-ghost btn-xs" (click)="setSort('tax_id')">{{ 'ADMIN.COMPANIES.COLUMNS.TAX_ID' | translate }}
              <span *ngIf="sortBy()==='tax_id'">{{ sortOrder()==='asc' ? '▲' : '▼' }}</span>
            </button>
          </th>
          <th>
            <button class="btn btn-ghost btn-xs" (click)="setSort('name')">{{ 'ADMIN.COMPANIES.COLUMNS.NAME' | translate }}
              <span *ngIf="sortBy()==='name'">{{ sortOrder()==='asc' ? '▲' : '▼' }}</span>
            </button>
          </th>
          <th>
            <button class="btn btn-ghost btn-xs" (click)="setSort('sector')">{{ 'ADMIN.COMPANIES.COLUMNS.SECTOR' | translate }}
              <span *ngIf="sortBy()==='sector'">{{ sortOrder()==='asc' ? '▲' : '▼' }}</span>
            </button>
          </th>
        </tr>
      </thead>
      <tbody class="page-stagger">
        @for (c of filteredItems(); track c.tax_id) {
          <tr>
            <td class="flex items-center gap-2">
              <span class="badge badge-outline badge-xs">{{ c.tax_id }}</span>
              <button class="btn btn-ghost btn-xs" (click)="copyTaxId(c.tax_id)" title="Copy">⧉</button>
            </td>
            <td>{{ c.name || '-' }}</td>
            <td>
              @if (c.sector) { <span class="badge badge-ghost badge-xs">{{ c.sector }}</span> } @else { - }
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
  <div class="flex flex-wrap items-center justify-end gap-2 glass-card p-2">
  <button class="btn btn-sm" (click)="prevPage()" [disabled]="page()<=1">{{ 'COMMON.PREVIOUS' | translate }}</button>
  <span class="text-sm opacity-70">{{ 'COMMON.PAGE' | translate }} {{ page() }}</span>
  <span class="text-sm opacity-60">• {{ items().length || 0 }} / {{ total() || '∞' }}</span>
  <button class="btn btn-sm" (click)="nextPage()" [disabled]="(page()*limit()) >= total()">{{ 'COMMON.NEXT' | translate }}</button>
  </div>
</div>
